{% extends "base.html" %}

{% block content %}
    {% include "nav.html" %}
    {% include "chat.html" %}
{% endblock %}

{% block scripts %}
    <script>
        // 初始化 Tooltip
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        tooltipTriggerList.forEach(function (tooltipTriggerEl) {
            new bootstrap.Tooltip(tooltipTriggerEl);
        });

        // 动态管理 active 类
        const navLinks = document.querySelectorAll('.nav-link');
        navLinks.forEach(link => {
            link.addEventListener('click', function (e) {
                e.preventDefault();
                navLinks.forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                console.log(`Clicked: ${this.textContent.trim()}`);
            });

            link.addEventListener('mouseover', function () {
                navLinks.forEach(l => l.classList.remove('active'));
                this.classList.add('active');
            });

            link.addEventListener('mouseout', function () {
                navLinks.forEach(l => l.classList.remove('active'));
                document.querySelector('.nav-link[aria-current="page"]').classList.add('active');
            });
        });

        // 聊天区域滚动到底部
        const chatArea = document.querySelector('.chat-area');
        chatArea.scrollTop = chatArea.scrollHeight;

        // 动态添加消息
        function addMessage(isAI, content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isAI ? 'ai-message' : 'streamer-message'}`;
            const bubble = document.createElement('div');
            bubble.className = 'bubble';
            bubble.textContent = content;
            const time = document.createElement('small');
            time.className = 'text-muted';
            time.textContent = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            messageDiv.appendChild(bubble);
            messageDiv.appendChild(time);
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        // 测试添加消息
        setTimeout(() => addMessage(true, "Nice topic!"), 2000);
    </script>
{% endblock %}